<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚ö° CYBER DUNGEON ‚ö°</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --neon-pink: #ff006e;
      --neon-cyan: #00f5ff;
      --neon-purple: #bf00ff;
      --neon-green: #39ff14;
      --neon-yellow: #ffff00;
      --dark-bg: #0a0014;
      --darker: #050008;
      --grid-color: rgba(0, 245, 255, 0.1);
      --panel-bg: rgba(10, 0, 20, 0.85);
      --text-primary: #00f5ff;
      --text-secondary: #ff006e;
      --text-muted: #8b5cf6;
    }

    /* Scanline Effect */
    @keyframes scanline {
      0% { transform: translateY(-100%); }
      100% { transform: translateY(100vh); }
    }

    /* Glitch Effect */
    @keyframes glitch {
      0%, 100% { transform: translate(0); }
      33% { transform: translate(-2px, 2px); }
      66% { transform: translate(2px, -2px); }
    }

    /* Neon Glow Pulse */
    @keyframes neon-pulse {
      0%, 100% { 
        box-shadow: 0 0 5px var(--neon-cyan), 0 0 10px var(--neon-cyan), 0 0 20px var(--neon-cyan);
        text-shadow: 0 0 5px var(--neon-cyan), 0 0 10px var(--neon-cyan);
      }
      50% { 
        box-shadow: 0 0 10px var(--neon-cyan), 0 0 20px var(--neon-cyan), 0 0 40px var(--neon-cyan);
        text-shadow: 0 0 10px var(--neon-cyan), 0 0 20px var(--neon-cyan);
      }
    }

    /* Hologram Flicker */
    @keyframes hologram {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.85; }
    }

    /* Electric Arc */
    @keyframes electric-arc {
      0%, 100% { 
        border-color: var(--neon-cyan);
        box-shadow: 0 0 10px var(--neon-cyan);
      }
      25% { 
        border-color: var(--neon-purple);
        box-shadow: 0 0 15px var(--neon-purple);
      }
      50% { 
        border-color: var(--neon-pink);
        box-shadow: 0 0 20px var(--neon-pink);
      }
      75% { 
        border-color: var(--neon-green);
        box-shadow: 0 0 15px var(--neon-green);
      }
    }

    /* Damage Number Animation */
    @keyframes damage-float {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(-80px) scale(1.5); opacity: 0; }
    }

    /* Grid Background Animation */
    @keyframes grid-move {
      0% { background-position: 0 0; }
      100% { background-position: 50px 50px; }
    }

    /* Circuit Trace */
    @keyframes circuit-trace {
      0% { stroke-dashoffset: 1000; }
      100% { stroke-dashoffset: 0; }
    }

    body {
      font-family: 'Rajdhani', sans-serif;
      background: var(--dark-bg);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 15px;
      position: relative;
      overflow-x: hidden;
      background-image: 
        linear-gradient(var(--grid-color) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: grid-move 20s linear infinite;
    }

    /* Scanline Overlay */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(transparent, var(--neon-cyan), transparent);
      animation: scanline 8s linear infinite;
      opacity: 0.3;
      pointer-events: none;
      z-index: 9999;
    }

    /* Vignette Effect */
    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      background: radial-gradient(circle at center, transparent 0%, var(--darker) 100%);
      z-index: 1;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
      z-index: 2;
    }

    /* Glitch Header */
    header {
      text-align: center;
      padding: 20px;
      background: var(--panel-bg);
      border: 2px solid var(--neon-cyan);
      border-radius: 0;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0, 245, 255, 0.3), inset 0 0 20px rgba(0, 245, 255, 0.1);
    }

    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 245, 255, 0.2), transparent);
      animation: scan-horizontal 3s linear infinite;
    }

    @keyframes scan-horizontal {
      0% { left: -100%; }
      100% { left: 200%; }
    }

    header h1 {
      font-family: 'Share Tech Mono', monospace;
      font-size: 2.8em;
      font-weight: 700;
      color: var(--neon-cyan);
      letter-spacing: 8px;
      text-transform: uppercase;
      text-shadow: 
        0 0 10px var(--neon-cyan),
        0 0 20px var(--neon-cyan),
        0 0 40px var(--neon-cyan),
        0 0 80px var(--neon-purple);
      animation: hologram 3s ease-in-out infinite;
      position: relative;
    }

    .subtitle {
      color: var(--neon-pink);
      font-size: 1.1em;
      letter-spacing: 4px;
      text-transform: uppercase;
      margin-top: 5px;
      text-shadow: 0 0 10px var(--neon-pink);
    }

    .stats-bar {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 15px;
    }

    .stat-badge {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid var(--neon-green);
      padding: 8px 16px;
      border-radius: 0;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.9em;
      text-transform: uppercase;
      box-shadow: 0 0 10px rgba(57, 255, 20, 0.5);
      transition: all 0.3s ease;
      clip-path: polygon(5% 0%, 100% 0%, 95% 100%, 0% 100%);
    }

    .stat-badge:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(57, 255, 20, 0.8);
    }

    /* Main Grid Layout */
    .main-grid {
      display: grid;
      grid-template-columns: 300px 1fr 300px;
      gap: 20px;
      margin-bottom: 20px;
    }

    /* Holographic Panels */
    .panel {
      background: var(--panel-bg);
      border: 2px solid var(--neon-purple);
      border-radius: 0;
      padding: 20px;
      position: relative;
      box-shadow: 0 0 15px rgba(191, 0, 255, 0.3), inset 0 0 15px rgba(191, 0, 255, 0.05);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .panel::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, var(--neon-cyan), var(--neon-pink), var(--neon-purple), var(--neon-green));
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
      border-radius: 0;
    }

    .panel:hover::before {
      opacity: 0.3;
      animation: electric-arc 2s linear infinite;
    }

    .panel h3 {
      font-family: 'Share Tech Mono', monospace;
      color: var(--neon-pink);
      font-size: 1.3em;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 3px;
      text-shadow: 0 0 10px var(--neon-pink);
      border-bottom: 1px solid var(--neon-pink);
      padding-bottom: 8px;
    }

    /* Character/Enemy Visuals */
    .character-visual, .enemy-visual {
      width: 100%;
      height: 180px;
      background: var(--darker);
      border: 2px solid var(--neon-cyan);
      margin-bottom: 15px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: 0 0 20px rgba(0, 245, 255, 0.4), inset 0 0 30px rgba(0, 245, 255, 0.1);
    }

    .enemy-visual {
      border-color: var(--neon-pink);
      box-shadow: 0 0 20px rgba(255, 0, 110, 0.4), inset 0 0 30px rgba(255, 0, 110, 0.1);
    }

    .character-visual img, .enemy-visual img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: saturate(1.5) contrast(1.2);
    }

    /* Combat Arena */
    .combat-zone {
      position: relative;
    }

    .combat-zone.in-combat {
      animation: electric-arc 3s ease-in-out infinite;
    }

    .combat-arena {
      position: relative;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin-bottom: 20px;
      min-height: 220px;
    }

    .combatant {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .combatant.attacking {
      animation: glitch 0.3s ease;
    }

    .combatant.hit .character-visual,
    .combatant.hit .enemy-visual {
      animation: glitch 0.2s ease 3;
      filter: brightness(1.5) hue-rotate(90deg);
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }

    .stat-box {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--neon-cyan);
      padding: 10px;
      text-align: center;
      font-family: 'Share Tech Mono', monospace;
      transition: all 0.3s ease;
      clip-path: polygon(0 0, 95% 0, 100% 100%, 5% 100%);
    }

    .stat-box:hover {
      background: rgba(0, 245, 255, 0.1);
      box-shadow: 0 0 15px rgba(0, 245, 255, 0.5);
    }

    .stat-box strong {
      display: block;
      color: var(--neon-green);
      font-size: 0.85em;
      margin-bottom: 5px;
      text-shadow: 0 0 5px var(--neon-green);
    }

    /* Progress Bars */
    .bar-container {
      margin: 12px 0;
    }

    .bar-label {
      display: flex;
      justify-content: space-between;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.95em;
      margin-bottom: 6px;
      color: var(--neon-cyan);
      text-shadow: 0 0 5px var(--neon-cyan);
    }

    .bar {
      height: 20px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid var(--neon-cyan);
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 0 10px rgba(0, 245, 255, 0.3);
    }

    .bar-fill {
      height: 100%;
      transition: width 0.5s ease;
      position: relative;
      box-shadow: 0 0 20px currentColor;
    }

    .hp-fill { 
      background: linear-gradient(90deg, var(--neon-pink), var(--neon-purple));
      box-shadow: 0 0 15px var(--neon-pink);
    }

    .mana-fill { 
      background: linear-gradient(90deg, var(--neon-cyan), var(--neon-purple));
      box-shadow: 0 0 15px var(--neon-cyan);
    }

    .xp-fill { 
      background: linear-gradient(90deg, var(--neon-green), var(--neon-cyan));
      box-shadow: 0 0 15px var(--neon-green);
    }

    /* Animated Bar Shimmer */
    .bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: shimmer 2s ease-in-out infinite;
    }

    @keyframes shimmer {
      0%, 100% { left: -100%; }
      50% { left: 200%; }
    }

    /* Status Effects */
    .status-effects {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .effect-badge {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid var(--neon-yellow);
      padding: 5px 10px;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.8em;
      text-transform: uppercase;
      animation: neon-pulse 2s ease-in-out infinite;
    }

    .effect-poison { border-color: var(--neon-green); color: var(--neon-green); }
    .effect-burn { border-color: var(--neon-pink); color: var(--neon-pink); }
    .effect-stun { border-color: var(--neon-yellow); color: var(--neon-yellow); }
    .effect-regen { border-color: var(--neon-cyan); color: var(--neon-cyan); }
    .effect-shield { border-color: var(--neon-purple); color: var(--neon-purple); }

    /* Skill Panel */
    .skill-panel {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--neon-purple);
      padding: 12px;
      margin-top: 15px;
      box-shadow: 0 0 10px rgba(191, 0, 255, 0.3);
    }

    .skill-name {
      font-family: 'Share Tech Mono', monospace;
      color: var(--neon-purple);
      font-size: 1.1em;
      margin-bottom: 5px;
      text-shadow: 0 0 5px var(--neon-purple);
    }

    .skill-desc {
      font-size: 0.9em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .skill-stats {
      display: flex;
      justify-content: space-between;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.85em;
    }

    /* Inventory Grid */
    .inventory-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(75px, 1fr));
      gap: 10px;
      max-height: 280px;
      overflow-y: auto;
    }

    .inventory-grid::-webkit-scrollbar {
      width: 8px;
    }

    .inventory-grid::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--neon-cyan);
    }

    .inventory-grid::-webkit-scrollbar-thumb {
      background: var(--neon-cyan);
      box-shadow: 0 0 10px var(--neon-cyan);
    }

    .item-card {
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid var(--neon-cyan);
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .item-card:hover {
      transform: scale(1.05) translateY(-5px);
      box-shadow: 0 0 20px currentColor;
    }

    .item-image {
      width: 55px;
      height: 55px;
      margin: 0 auto 8px;
      overflow: hidden;
      border: 1px solid var(--neon-cyan);
    }

    .item-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .item-name {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.75em;
      text-transform: uppercase;
    }

    .rarity-common { border-color: var(--text-muted); color: var(--text-muted); }
    .rarity-uncommon { border-color: var(--neon-green); color: var(--neon-green); }
    .rarity-rare { border-color: var(--neon-cyan); color: var(--neon-cyan); }
    .rarity-epic { border-color: var(--neon-purple); color: var(--neon-purple); }
    .rarity-legendary { 
      border-color: var(--neon-yellow); 
      color: var(--neon-yellow);
      animation: electric-arc 2s linear infinite;
    }

    /* Buttons */
    .buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 12px 0;
    }

    button {
      flex: 1;
      padding: 12px 16px;
      background: rgba(0, 0, 0, 0.7);
      color: var(--neon-cyan);
      border: 2px solid var(--neon-cyan);
      font-family: 'Share Tech Mono', monospace;
      font-weight: 700;
      cursor: pointer;
      font-size: 0.95em;
      text-transform: uppercase;
      letter-spacing: 2px;
      transition: all 0.3s ease;
      min-width: 120px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0, 245, 255, 0.3);
      clip-path: polygon(8% 0%, 100% 0%, 92% 100%, 0% 100%);
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 245, 255, 0.5), transparent);
      transition: left 0.5s ease;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover {
      background: rgba(0, 245, 255, 0.2);
      box-shadow: 0 0 20px var(--neon-cyan), inset 0 0 20px rgba(0, 245, 255, 0.3);
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      transform: none;
    }

    .btn-combat { 
      border-color: var(--neon-pink); 
      color: var(--neon-pink);
      box-shadow: 0 0 10px rgba(255, 0, 110, 0.3);
    }
    .btn-combat:hover {
      background: rgba(255, 0, 110, 0.2);
      box-shadow: 0 0 20px var(--neon-pink);
    }

    .btn-defend { 
      border-color: var(--neon-green); 
      color: var(--neon-green);
      box-shadow: 0 0 10px rgba(57, 255, 20, 0.3);
    }
    .btn-defend:hover {
      background: rgba(57, 255, 20, 0.2);
      box-shadow: 0 0 20px var(--neon-green);
    }

    .btn-skill { 
      border-color: var(--neon-purple); 
      color: var(--neon-purple);
      box-shadow: 0 0 10px rgba(191, 0, 255, 0.3);
    }
    .btn-skill:hover {
      background: rgba(191, 0, 255, 0.2);
      box-shadow: 0 0 20px var(--neon-purple);
    }

    .btn-item { 
      border-color: var(--neon-yellow); 
      color: var(--neon-yellow);
      box-shadow: 0 0 10px rgba(255, 255, 0, 0.3);
    }
    .btn-item:hover {
      background: rgba(255, 255, 0, 0.2);
      box-shadow: 0 0 20px var(--neon-yellow);
    }

    .btn-shop { 
      border-color: var(--neon-yellow); 
      color: var(--neon-yellow);
      box-shadow: 0 0 10px rgba(255, 255, 0, 0.3);
    }
    .btn-shop:hover {
      background: rgba(255, 255, 0, 0.2);
      box-shadow: 0 0 20px var(--neon-yellow);
    }

    /* Game Log */
    .game-log {
      background: var(--panel-bg);
      border: 2px solid var(--neon-green);
      padding: 15px;
      max-height: 220px;
      overflow-y: auto;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.9em;
      margin-top: 20px;
      box-shadow: 0 0 15px rgba(57, 255, 20, 0.3);
    }

    .game-log::-webkit-scrollbar {
      width: 8px;
    }

    .game-log::-webkit-scrollbar-thumb {
      background: var(--neon-green);
      box-shadow: 0 0 10px var(--neon-green);
    }

    .log-entry {
      margin: 6px 0;
      padding: 6px;
      border-left: 2px solid var(--neon-cyan);
      padding-left: 10px;
    }

    .log-room { color: var(--neon-yellow); border-color: var(--neon-yellow); }
    .log-combat { color: var(--neon-pink); border-color: var(--neon-pink); }
    .log-success { color: var(--neon-green); border-color: var(--neon-green); }
    .log-boss { color: var(--neon-purple); border-color: var(--neon-purple); }
    .log-achievement { color: var(--neon-yellow); border-color: var(--neon-yellow); }
    .log-info { color: var(--neon-cyan); border-color: var(--neon-cyan); }

    /* Combat Status */
    #combatStatus {
      text-align: center;
      font-family: 'Share Tech Mono', monospace;
      font-weight: bold;
      font-size: 1.2em;
      margin: 15px 0;
      padding: 10px;
      border: 2px solid var(--neon-green);
      background: rgba(0, 0, 0, 0.5);
      text-shadow: 0 0 10px currentColor;
      letter-spacing: 3px;
    }

    /* Modals */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .modal-content {
      background: var(--panel-bg);
      border: 3px solid var(--neon-cyan);
      padding: 30px;
      max-width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(0, 245, 255, 0.6), inset 0 0 40px rgba(0, 245, 255, 0.1);
      position: relative;
    }

    .modal-header {
      font-family: 'Share Tech Mono', monospace;
      font-size: 2em;
      color: var(--neon-cyan);
      text-align: center;
      margin-bottom: 25px;
      text-transform: uppercase;
      letter-spacing: 4px;
      text-shadow: 0 0 20px var(--neon-cyan);
      border-bottom: 2px solid var(--neon-cyan);
      padding-bottom: 15px;
    }

    /* Damage Numbers */
    .damage-number {
      position: absolute;
      font-size: 2.5em;
      font-weight: bold;
      font-family: 'Share Tech Mono', monospace;
      color: var(--neon-pink);
      text-shadow: 0 0 20px currentColor;
      animation: damage-float 1.2s ease-out forwards;
      pointer-events: none;
      z-index: 30;
      letter-spacing: 3px;
    }

    .damage-number.heal {
      color: var(--neon-green);
    }

    .damage-number.critical {
      color: var(--neon-yellow);
      font-size: 3em;
      text-shadow: 0 0 30px var(--neon-yellow);
      animation: damage-float 1.2s ease-out forwards, glitch 0.2s ease 3;
    }

    .damage-number.miss {
      color: var(--neon-cyan);
      font-size: 2em;
      opacity: 0.6;
    }

    /* Combat Canvas */
    .combat-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 15;
    }

    /* Slash Effect */
    .slash-effect {
      position: absolute;
      width: 120px;
      height: 4px;
      background: linear-gradient(90deg, transparent, var(--neon-cyan), var(--neon-purple), transparent);
      box-shadow: 0 0 20px var(--neon-cyan);
      animation: slash 0.5s ease-out forwards;
      pointer-events: none;
      z-index: 20;
    }

    @keyframes slash {
      0% { transform: scaleX(0) rotate(-45deg); opacity: 1; }
      50% { opacity: 1; }
      100% { transform: scaleX(1.5) rotate(-45deg); opacity: 0; }
    }

    /* Shield Effect */
    .shield-effect {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 160px;
      height: 160px;
      border: 4px solid var(--neon-cyan);
      border-radius: 50%;
      animation: shield-pulse 1.5s ease-in-out infinite;
      pointer-events: none;
      z-index: 20;
      box-shadow: 0 0 30px var(--neon-cyan), inset 0 0 30px var(--neon-cyan);
    }

    @keyframes shield-pulse {
      0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.7; }
      50% { transform: translate(-50%, -50%) scale(1.15); opacity: 1; }
    }

    /* Fire Particles */
    .fire-particle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, var(--neon-pink), var(--neon-purple));
      border-radius: 50%;
      animation: fire-particle 1.2s ease-out forwards;
      pointer-events: none;
      z-index: 20;
      box-shadow: 0 0 15px currentColor;
    }

    @keyframes fire-particle {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(-120px) scale(0.3); opacity: 0; }
    }

    /* Action Indicator */
    .action-indicator {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 2.5em;
      animation: pulse 0.6s ease;
      pointer-events: none;
      z-index: 25;
      text-shadow: 0 0 20px currentColor;
    }

    @keyframes pulse {
      0%, 100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.3); }
    }

    /* Tooltip */
    [data-tooltip] {
      position: relative;
    }

    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 120%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.95);
      border: 1px solid var(--neon-cyan);
      padding: 8px 12px;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.85em;
      color: var(--neon-cyan);
      z-index: 50;
      white-space: nowrap;
      box-shadow: 0 0 15px rgba(0, 245, 255, 0.5);
      text-shadow: 0 0 5px var(--neon-cyan);
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .main-grid { 
        grid-template-columns: 1fr 1fr; 
      }
      .panel:last-child { 
        grid-column: 1 / -1; 
      }
    }

    @media (max-width: 768px) {
      .main-grid { 
        grid-template-columns: 1fr; 
      }
      header h1 { 
        font-size: 2em; 
        letter-spacing: 4px;
      }
      button { 
        font-size: 0.85em; 
        padding: 10px 12px; 
        min-width: 100px;
      }
      .character-visual, .enemy-visual { 
        height: 150px; 
      }
      .combat-arena { 
        grid-template-columns: 1fr; 
      }
      .damage-number {
        font-size: 2em;
      }
      .damage-number.critical {
        font-size: 2.5em;
      }
    }

    /* Death Screen Special Effect */
    #gameOverModal .modal-content {
      border-color: var(--neon-pink);
      box-shadow: 0 0 50px rgba(255, 0, 110, 0.8);
      animation: glitch 0.5s ease infinite;
    }

    #gameOverModal .modal-header {
      color: var(--neon-pink);
      text-shadow: 0 0 30px var(--neon-pink);
    }

    .death-scene {
      border: 2px solid var(--neon-pink);
      box-shadow: 0 0 30px rgba(255, 0, 110, 0.5), inset 0 0 30px rgba(255, 0, 110, 0.2);
      background-size: cover;
      background-position: center;
      filter: grayscale(0.3) contrast(1.3);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>‚ö° CYBER DUNGEON ‚ö°</h1>
      <div class="subtitle">// NEON ROGUELIKE //</div>
      <div class="stats-bar">
        <div class="stat-badge" data-tooltip="Total credits earned">üí∞ <span id="headerGold">0</span> CR</div>
        <div class="stat-badge" data-tooltip="Deepest level reached">üèÜ MAX LVL: <span id="headerBest">0</span></div>
        <div class="stat-badge" data-tooltip="Total hostiles eliminated">‚öîÔ∏è FRAGS: <span id="headerKills">0</span></div>
        <div class="stat-badge" data-tooltip="Total runs executed">üéÆ RUNS: <span id="headerRuns">0</span></div>
      </div>
    </header>

    <div class="main-grid">
      <!-- Character Panel -->
      <div class="panel">
        <h3>// OPERATIVE //</h3>
        <div class="character-visual" id="charVisual"></div>
        <div class="stats-grid">
          <div class="stat-box" data-tooltip="Operative class designation"><strong>CLASS</strong><span id="charClass">-</span></div>
          <div class="stat-box" data-tooltip="Current level"><strong>LEVEL</strong><span id="charLevel">1</span></div>
          <div class="stat-box" data-tooltip="Unit rarity tier"><strong>TIER</strong><span id="charRarity">-</span></div>
          <div class="stat-box" data-tooltip="Current sector depth"><strong>DEPTH</strong><span id="charFloor">1</span></div>
        </div>
        <div class="bar-container">
          <div class="bar-label"><strong>‚ù§Ô∏è VITALS</strong><span id="hpText">0/0</span></div>
          <div class="bar"><div class="bar-fill hp-fill" id="hpBar" style="width: 100%;"></div></div>
        </div>
        <div class="bar-container">
          <div class="bar-label"><strong>‚ú® ENERGY</strong><span id="manaText">0/0</span></div>
          <div class="bar"><div class="bar-fill mana-fill" id="manaBar" style="width: 100%;"></div></div>
        </div>
        <div class="bar-container">
          <div class="bar-label"><strong>‚≠ê EXP</strong><span id="xpText">0/100</span></div>
          <div class="bar"><div class="bar-fill xp-fill" id="xpBar" style="width: 0%;"></div></div>
        </div>
        <div class="stats-grid">
          <div class="stat-box" data-tooltip="Raw attack power"><strong>üí™ PWR</strong><span id="statStr">10</span></div>
          <div class="stat-box" data-tooltip="Speed and precision"><strong>‚ö° SPD</strong><span id="statAgi">10</span></div>
          <div class="stat-box" data-tooltip="Neural capacity"><strong>üß† INT</strong><span id="statInt">8</span></div>
          <div class="stat-box" data-tooltip="Damage reduction"><strong>üõ°Ô∏è ARM</strong><span id="statDef">5</span></div>
        </div>
        <div class="status-effects" id="playerEffects"></div>
        <div class="skill-panel" id="skillPanel" style="display: none;">
          <div class="skill-name" id="skillName">-</div>
          <div class="skill-desc" id="skillDesc">-</div>
          <div class="skill-stats">
            <span>üíß COST: <span id="skillCost">0</span></span>
            <span>‚è±Ô∏è CD: <span id="skillCD">Ready</span></span>
          </div>
        </div>
      </div>

      <!-- Combat Zone -->
      <div class="panel combat-zone" id="combatZone">
        <h3>// COMBAT ARENA //</h3>
        <div class="combat-arena" id="combatArena">
          <canvas class="combat-canvas" id="combatCanvas"></canvas>
          <div class="combatant" id="playerCombatant">
            <div class="character-visual" id="charVisualCombat"></div>
          </div>
          <div class="combatant" id="enemyCombatant">
            <div class="enemy-visual" id="enemyVisual"></div>
          </div>
        </div>
        <div class="stats-grid">
          <div class="stat-box" data-tooltip="Hostile designation"><strong>TARGET</strong><span id="enemyName">NO TARGET</span></div>
          <div class="stat-box" data-tooltip="Threat level"><strong>LEVEL</strong><span id="enemyLevel">-</span></div>
          <div class="stat-box" data-tooltip="Attack capability"><strong>‚öîÔ∏è ATK</strong><span id="enemyAtk">0</span></div>
          <div class="stat-box" data-tooltip="Defense rating"><strong>üõ°Ô∏è DEF</strong><span id="enemyDef">0</span></div>
        </div>
        <div class="bar-container">
          <div class="bar-label"><strong>‚ù§Ô∏è HOSTILE HP</strong><span id="enemyHpText">0/0</span></div>
          <div class="bar"><div class="bar-fill hp-fill" id="enemyHpBar" style="width: 0%;"></div></div>
        </div>
        <div id="combatStatus">üü¢ STANDBY</div>
        <div class="status-effects" id="enemyEffects"></div>

        <div class="buttons" id="mainButtons">
          <button onclick="generateCharacter()" aria-label="Generate operative" data-tooltip="Initialize new operative">[N] NEW OPERATIVE</button>
          <button onclick="enterDungeon()" aria-label="Enter sector" data-tooltip="Begin infiltration">[E] ENTER SECTOR</button>
          <button onclick="exploreDungeon()" aria-label="Scan area" data-tooltip="Scan current level">[X] SCAN</button>
          <button onclick="nextFloor()" id="nextFloorBtn" style="display: none;" aria-label="Descend deeper" data-tooltip="Go deeper">[D] DESCEND</button>
        </div>

        <div class="buttons" id="combatButtons" style="display: none;">
          <button class="btn-combat" onclick="attackEnemy()" aria-label="Attack hostile" data-tooltip="Execute attack protocol">[A] ATTACK</button>
          <button class="btn-defend" onclick="defendAction()" aria-label="Defensive stance" data-tooltip="Activate shields">[D] DEFEND</button>
          <button class="btn-skill" onclick="useSkill()" id="skillBtn" aria-label="Special ability" data-tooltip="Use cyber ability">[S] ABILITY</button>
          <button class="btn-item" onclick="usePotion()" id="potionBtn" aria-label="Use stimpack" data-tooltip="Consume item">[P] STIM (0)</button>
          <button onclick="attemptFlee()" aria-label="Retreat" data-tooltip="Emergency extraction">[F] RETREAT</button>
        </div>

        <div class="buttons">
          <button class="btn-shop" onclick="openShop()" id="shopBtn" aria-label="Access market" data-tooltip="Buy equipment">[H] MARKET</button>
          <button class="btn-item" onclick="openCrafting()" aria-label="Fabrication lab" data-tooltip="Craft/upgrade gear">[C] FABRICATE</button>
          <button onclick="openAchievements()" aria-label="View achievements" data-tooltip="Mission log">[V] MISSIONS</button>
        </div>
      </div>

      <!-- Inventory Panel -->
      <div class="panel">
        <h3>// LOADOUT //</h3>
        <div style="margin-bottom: 12px;">
          <strong style="color: var(--neon-cyan);">‚öîÔ∏è WEAPON:</strong>
          <span id="equippedWeapon">None</span>
        </div>
        <div style="margin-bottom: 12px;">
          <strong style="color: var(--neon-cyan);">üõ°Ô∏è ARMOR:</strong>
          <span id="equippedArmor">None</span>
        </div>
        <div style="margin-bottom: 15px;">
          <strong style="color: var(--neon-cyan);">üì¶ ITEMS: <span id="itemCount">0</span> | üîß PARTS: <span id="matsCount">0</span></strong>
        </div>
        <div class="inventory-grid" id="inventoryGrid">
          <div style="grid-column: 1/-1; text-align: center; color: var(--text-muted); padding: 20px;">EMPTY</div>
        </div>
      </div>
    </div>

    <!-- Game Log -->
    <div class="game-log" id="gameLog">
      <div class="log-entry log-info">üéÆ &gt;&gt; SYSTEM ONLINE. Use [N] to initialize operative.</div>
    </div>
  </div>

  <!-- Shop Modal -->
  <div class="modal" id="shopModal">
    <div class="modal-content">
      <div class="modal-header">// BLACK MARKET //</div>
      <div style="text-align: center; margin-bottom: 20px; font-family: 'Share Tech Mono', monospace;">
        üí∞ CREDITS: <span id="shopGold" style="color: var(--neon-yellow); text-shadow: 0 0 10px var(--neon-yellow);">0</span>
      </div>
      <div class="inventory-grid" id="shopGrid"></div>
      <button onclick="closeShop()" style="width: 100%; margin-top: 20px;" aria-label="Exit market">EXIT MARKET</button>
    </div>
  </div>

  <!-- Crafting Modal -->
  <div class="modal" id="craftModal">
    <div class="modal-content">
      <div class="modal-header">// FABRICATION LAB //</div>
      <div style="text-align: center; margin-bottom: 20px; font-family: 'Share Tech Mono', monospace;">
        üîß TECH PARTS: <span id="craftMats" style="color: var(--neon-green); text-shadow: 0 0 10px var(--neon-green);">0</span>
      </div>
      <div class="buttons" style="flex-direction: column; gap: 12px;">
        <button onclick="craftItem('upgrade_weapon')" aria-label="Upgrade weapon">‚öîÔ∏è UPGRADE WEAPON (10 parts)</button>
        <button onclick="craftItem('upgrade_armor')" aria-label="Upgrade armor">üõ°Ô∏è UPGRADE ARMOR (10 parts)</button>
        <button onclick="craftItem('craft_potion')" aria-label="Craft health stim">üß™ CRAFT HEALTH STIM (5 parts)</button>
        <button onclick="craftItem('craft_mana')" aria-label="Craft energy cell">‚ú® CRAFT ENERGY CELL (5 parts)</button>
      </div>
      <button onclick="closeCrafting()" style="width: 100%; margin-top: 20px;" aria-label="Exit lab">EXIT LAB</button>
    </div>
  </div>

  <!-- Achievements Modal -->
  <div class="modal" id="achievementsModal">
    <div class="modal-content">
      <div class="modal-header">// MISSION LOG //</div>
      <div class="inventory-grid" id="achievementList"></div>
      <button onclick="closeAchievements()" style="width: 100%; margin-top: 20px;" aria-label="Close log">CLOSE LOG</button>
    </div>
  </div>

  <!-- Game Over Modal -->
  <div class="modal" id="gameOverModal">
    <div class="modal-content">
      <div class="modal-header">üíÄ SYSTEM FAILURE üíÄ</div>
      <div class="death-scene" id="deathScene" style="height: 180px;"></div>
      <div style="text-align: center; margin: 25px 0; font-family: 'Share Tech Mono', monospace;">
        <p style="margin: 8px 0;">DEPTH: <span id="finalFloor" style="color: var(--neon-cyan);">0</span></p>
        <p style="margin: 8px 0;">LEVEL: <span id="finalLevel" style="color: var(--neon-cyan);">0</span></p>
        <p style="margin: 8px 0;">FRAGS: <span id="finalKills" style="color: var(--neon-cyan);">0</span></p>
        <p style="margin: 8px 0;">CREDITS: <span id="finalGold" style="color: var(--neon-yellow);">0</span></p>
      </div>
      <button onclick="restartGame()" style="width: 100%;" aria-label="Restart system">üîÑ REBOOT SYSTEM</button>
    </div>
  </div>

  <script>
    // Game State (unchanged logic from original)
    const gameState = {
      player: { class: null, rarity: 'Common', strength: 10, agility: 10, intelligence: 8, defense: 5,
        maxHP: 50, hp: 50, maxMana: 50, mana: 50, level: 1, exp: 0, expToLevel: 100, floor: 1, gold: 0,
        defending: false, effects: [], skillCooldown: 0 },
      inventory: { weapon: null, armor: null, items: [], materials: 0 },
      meta: { totalRuns: 0, bestFloor: 0, totalKills: 0, achievements: [] },
      enemy: null, inCombat: false, roomsExplored: 0, monstersKilled: 0
    };

    const data = {
      classes: {
        'Warrior': { str: 15, agi: 10, int: 5, def: 8, hp: 60, mana: 30, skill: { name: 'Power Strike', cost: 15, cd: 3, effect: 'Deal 2.5x damage' }},
        'Mage': { str: 5, agi: 8, int: 18, def: 4, hp: 40, mana: 80, skill: { name: 'Fireball', cost: 25, cd: 2, effect: 'AoE damage + burn' }},
        'Rogue': { str: 10, agi: 18, int: 8, def: 5, hp: 45, mana: 50, skill: { name: 'Critical Strike', cost: 20, cd: 3, effect: 'Guaranteed critical' }},
        'Paladin': { str: 12, agi: 8, int: 12, def: 10, hp: 55, mana: 60, skill: { name: 'Divine Shield', cost: 30, cd: 4, effect: 'Shield + heal over time' }}
      },
      monsters: [
        { name: 'Goblin', hpMod: 0.8, atkMod: 0.8, defMod: 0.7 },
        { name: 'Orc', hpMod: 1.2, atkMod: 1.1, defMod: 1.0 },
        { name: 'Skeleton', hpMod: 0.9, atkMod: 0.9, defMod: 0.6 },
        { name: 'Dark Knight', hpMod: 1.5, atkMod: 1.3, defMod: 1.4 },
        { name: 'Demon', hpMod: 1.8, atkMod: 1.6, defMod: 1.2 },
        { name: 'Dragon', hpMod: 2.5, atkMod: 2.0, defMod: 1.8 }
      ],
      bosses: [
        { name: 'Ancient Lich King', hpMod: 3.5, atkMod: 2.5, defMod: 2.0 },
        { name: 'Infernal Dragon', hpMod: 4.0, atkMod: 3.0, defMod: 2.5 },
        { name: 'Void Titan', hpMod: 5.0, atkMod: 4.0, defMod: 3.0 }
      ],
      weapons: [
        { name: 'Iron Sword', str: 5, rarity: 'Common', cost: 50, icon: '‚öîÔ∏è' },
        { name: 'Steel Blade', str: 10, rarity: 'Uncommon', cost: 120, icon: 'üó°Ô∏è' },
        { name: 'Enchanted Sword', str: 18, rarity: 'Rare', cost: 300, icon: '‚öîÔ∏è' },
        { name: 'Dragon Slayer', str: 30, rarity: 'Epic', cost: 600, icon: 'üó°Ô∏è' },
        { name: 'Excalibur', str: 50, rarity: 'Legendary', cost: 1200, icon: '‚öîÔ∏è' }
      ],
      armor: [
        { name: 'Leather Armor', def: 5, rarity: 'Common', cost: 50, icon: 'üõ°Ô∏è' },
        { name: 'Chain Mail', def: 10, rarity: 'Uncommon', cost: 120, icon: 'üõ°Ô∏è' },
        { name: 'Plate Armor', def: 18, rarity: 'Rare', cost: 300, icon: 'üõ°Ô∏è' },
        { name: 'Dragon Scale', def: 30, rarity: 'Epic', cost: 600, icon: 'üõ°Ô∏è' },
        { name: 'Aegis Shield', def: 50, rarity: 'Legendary', cost: 1200, icon: 'üõ°Ô∏è' }
      ],
      potions: [
        { name: 'Health Potion', heal: 50, cost: 30, rarity: 'Common', icon: 'üß™' },
        { name: 'Greater Potion', heal: 100, cost: 70, rarity: 'Uncommon', icon: 'üß™' },
        { name: 'Mana Potion', mana: 50, cost: 40, rarity: 'Common', icon: '‚ú®' }
      ],
      achievements: [
        { id: 'first_kill', name: 'First Blood', desc: 'Defeat your first enemy', icon: 'ü©∏' },
        { id: 'floor_5', name: 'Deep Dive', desc: 'Reach floor 5', icon: 'üåä' },
        { id: 'floor_10', name: 'Into the Abyss', desc: 'Reach floor 10', icon: 'üï≥Ô∏è' },
        { id: 'level_10', name: 'Veteran', desc: 'Reach level 10', icon: '‚öîÔ∏è' },
        { id: 'kills_50', name: 'Monster Hunter', desc: 'Kill 50 enemies', icon: 'üëπ' },
        { id: 'boss_kill', name: 'Boss Slayer', desc: 'Defeat a boss', icon: 'üëë' },
        { id: 'legendary', name: 'Legendary Hero', desc: 'Equip legendary item', icon: 'üíé' },
        { id: 'rich', name: 'Wealthy', desc: 'Accumulate 1000 gold', icon: 'üí∞' }
      ]
    };

    const fallbackImages = {
      character: 'https://via.placeholder.com/180x180/0a0014/00f5ff?text=OPERATIVE',
      enemy: 'https://via.placeholder.com/180x180/0a0014/ff006e?text=HOSTILE',
      item: 'https://via.placeholder.com/55x55/0a0014/00f5ff?text=ITEM'
    };

    // Combat Graphics System
    const combatGraphics = {
      canvas: null,
      ctx: null,

      init() {
        this.canvas = document.getElementById('combatCanvas');
        if (!this.canvas) return;

        const arena = document.getElementById('combatArena');
        this.canvas.width = arena.offsetWidth;
        this.canvas.height = arena.offsetHeight;
        this.ctx = this.canvas.getContext('2d');

        window.addEventListener('resize', () => {
          this.canvas.width = arena.offsetWidth;
          this.canvas.height = arena.offsetHeight;
        });
      },

      showDamageNumber(damage, target, isCritical = false, isHeal = false, isMiss = false) {
        const targetEl = target === 'enemy' ? document.getElementById('enemyCombatant') : document.getElementById('playerCombatant');
        if (!targetEl) return;

        const rect = targetEl.getBoundingClientRect();
        const arenaRect = document.getElementById('combatArena').getBoundingClientRect();

        const damageEl = document.createElement('div');
        damageEl.className = 'damage-number';
        if (isCritical) damageEl.classList.add('critical');
        if (isHeal) damageEl.classList.add('heal');
        if (isMiss) damageEl.classList.add('miss');

        damageEl.textContent = isMiss ? 'MISS!' : (isHeal ? `+${damage}` : `-${damage}`);
        damageEl.style.left = (rect.left - arenaRect.left + rect.width / 2) + 'px';
        damageEl.style.top = (rect.top - arenaRect.top + rect.height / 2) + 'px';

        document.getElementById('combatArena').appendChild(damageEl);
        setTimeout(() => damageEl.remove(), 1200);
      },

      showSlashEffect(fromTarget, toTarget) {
        const from = fromTarget === 'player' ? document.getElementById('playerCombatant') : document.getElementById('enemyCombatant');
        const to = toTarget === 'enemy' ? document.getElementById('enemyCombatant') : document.getElementById('playerCombatant');
        if (!from || !to) return;

        const fromRect = from.getBoundingClientRect();
        const toRect = to.getBoundingClientRect();
        const arenaRect = document.getElementById('combatArena').getBoundingClientRect();

        const slash = document.createElement('div');
        slash.className = 'slash-effect';
        slash.style.left = (fromRect.right - arenaRect.left) + 'px';
        slash.style.top = (fromRect.top - arenaRect.top + fromRect.height / 2) + 'px';
        slash.style.transformOrigin = 'left center';

        document.getElementById('combatArena').appendChild(slash);
        setTimeout(() => slash.remove(), 500);
      },

      showShieldEffect(target) {
        const targetEl = target === 'player' ? document.getElementById('charVisualCombat') : document.getElementById('enemyVisual');
        if (!targetEl) return;

        const shield = document.createElement('div');
        shield.className = 'shield-effect';
        targetEl.appendChild(shield);
        setTimeout(() => shield.remove(), 1500);
      },

      showFireParticles(target) {
        const targetEl = target === 'enemy' ? document.getElementById('enemyCombatant') : document.getElementById('playerCombatant');
        if (!targetEl) return;

        const rect = targetEl.getBoundingClientRect();
        const arenaRect = document.getElementById('combatArena').getBoundingClientRect();

        for (let i = 0; i < 20; i++) {
          setTimeout(() => {
            const particle = document.createElement('div');
            particle.className = 'fire-particle';
            particle.style.left = (rect.left - arenaRect.left + Math.random() * rect.width) + 'px';
            particle.style.top = (rect.top - arenaRect.top + Math.random() * rect.height) + 'px';
            particle.style.animationDelay = (Math.random() * 0.3) + 's';

            document.getElementById('combatArena').appendChild(particle);
            setTimeout(() => particle.remove(), 1200);
          }, i * 40);
        }
      },

      showActionIndicator(target, icon) {
        const targetEl = target === 'player' ? document.getElementById('playerCombatant') : document.getElementById('enemyCombatant');
        if (!targetEl) return;

        const indicator = document.createElement('div');
        indicator.className = 'action-indicator';
        indicator.textContent = icon;
        targetEl.appendChild(indicator);
        setTimeout(() => indicator.remove(), 600);
      },

      applyCombatClass(target, className, duration = 500) {
        const targetEl = target === 'player' ? document.getElementById('playerCombatant') : document.getElementById('enemyCombatant');
        if (!targetEl) return;

        targetEl.classList.add(className);
        setTimeout(() => targetEl.classList.remove(className), duration);
      }
    };

    // Initialize combat graphics on page load
    window.addEventListener('DOMContentLoaded', () => {
      combatGraphics.init();
    });

    function getPollinationImage(prompt, seed, type = 'character') {
      const encodedPrompt = encodeURIComponent(prompt);
      return `https://image.pollinations.ai/prompt/${encodedPrompt}?width=400&height=400&seed=${seed}&nologo=true&enhance=true`;
    }

    function getItemImage(item) {
      if (item.icon) {
        return `<div style="font-size: 2.5em;">${item.icon}</div>`;
      }
      return `<img src="${fallbackImages.item}" alt="${item.name}" />`;
    }

    function generateCharacter() {
      const classes = Object.keys(data.classes);
      const charClass = classes[Math.floor(Math.random() * classes.length)];
      const stats = data.classes[charClass];

      gameState.player.class = charClass;
      gameState.player.strength = stats.str;
      gameState.player.agility = stats.agi;
      gameState.player.intelligence = stats.int;
      gameState.player.defense = stats.def;
      gameState.player.maxHP = stats.hp;
      gameState.player.hp = stats.hp;
      gameState.player.maxMana = stats.mana;
      gameState.player.mana = stats.mana;
      gameState.player.level = 1;
      gameState.player.exp = 0;
      gameState.player.floor = 1;
      gameState.player.gold = 0;
      gameState.player.defending = false;
      gameState.player.effects = [];
      gameState.player.skillCooldown = 0;

      gameState.inventory = { weapon: null, armor: null, items: [], materials: 0 };
      gameState.enemy = null;
      gameState.inCombat = false;
      gameState.roomsExplored = 0;
      gameState.monstersKilled = 0;

      const seed = Date.now();
      const charImg = getPollinationImage(`cyberpunk ${charClass} character, neon armor, futuristic warrior, glowing weapons, high-tech hero`, seed, 'character');
      document.getElementById('charVisual').style.backgroundImage = `url(${charImg})`;
      document.getElementById('charVisual').style.backgroundSize = 'cover';
      document.getElementById('charVisual').style.backgroundPosition = 'center';
      document.getElementById('charVisualCombat').style.backgroundImage = `url(${charImg})`;
      document.getElementById('charVisualCombat').style.backgroundSize = 'cover';
      document.getElementById('charVisualCombat').style.backgroundPosition = 'center';

      log(`üéÆ &gt;&gt; OPERATIVE INITIALIZED: ${charClass.toUpperCase()} [CLASS ${charClass.toUpperCase()}]`, 'success');
      updateUI();
    }

    function enterDungeon() {
      if (!gameState.player.class) {
        log('‚ö†Ô∏è &gt;&gt; ERROR: Initialize operative first', 'info');
        return;
      }
      gameState.player.floor = 1;
      gameState.roomsExplored = 0;
      gameState.monstersKilled = 0;
      log(`üö™ &gt;&gt; ENTERING CYBER SECTOR 1`, 'room');
      updateUI();
    }

    function exploreDungeon() {
      if (!gameState.player.class) {
        log('‚ö†Ô∏è &gt;&gt; ERROR: Initialize operative first', 'info');
        return;
      }
      if (gameState.inCombat) {
        log('‚ö†Ô∏è &gt;&gt; ERROR: Combat in progress', 'info');
        return;
      }

      gameState.roomsExplored++;
      const roll = Math.random();

      if (roll < 0.5) {
        spawnEnemy();
      } else if (roll < 0.7) {
        const goldFound = Math.floor(Math.random() * 30) + 10;
        gameState.player.gold += goldFound;
        log(`üí∞ &gt;&gt; CREDITS ACQUIRED: +${goldFound} CR`, 'success');
        updateUI();
      } else if (roll < 0.85) {
        const matsFound = Math.floor(Math.random() * 5) + 1;
        gameState.inventory.materials += matsFound;
        log(`üîß &gt;&gt; TECH PARTS SALVAGED: +${matsFound}`, 'success');
        updateUI();
      } else {
        log(`üîç &gt;&gt; SECTOR CLEAR`, 'info');
      }
    }

    function spawnEnemy() {
      const isBoss = gameState.player.floor % 5 === 0 && gameState.roomsExplored % 5 === 0;
      const enemyData = isBoss ? 
        data.bosses[Math.min(Math.floor(gameState.player.floor / 5) - 1, data.bosses.length - 1)] :
        data.monsters[Math.min(Math.floor(gameState.player.floor / 2), data.monsters.length - 1)];

      const baseHP = 30 + gameState.player.floor * 5;
      const baseAtk = 5 + gameState.player.floor * 2;
      const baseDef = 3 + gameState.player.floor;

      gameState.enemy = {
        name: enemyData.name,
        level: gameState.player.floor,
        maxHP: Math.floor(baseHP * enemyData.hpMod),
        hp: Math.floor(baseHP * enemyData.hpMod),
        attack: Math.floor(baseAtk * enemyData.atkMod),
        defense: Math.floor(baseDef * enemyData.defMod),
        effects: [],
        isBoss: isBoss
      };

      const seed = Date.now();
      const enemyImg = getPollinationImage(`cyberpunk ${enemyData.name} monster, neon horror, futuristic enemy, glowing hostile, tech demon`, seed, 'enemy');
      document.getElementById('enemyVisual').style.backgroundImage = `url(${enemyImg})`;
      document.getElementById('enemyVisual').style.backgroundSize = 'cover';
      document.getElementById('enemyVisual').style.backgroundPosition = 'center';

      gameState.inCombat = true;
      document.getElementById('combatZone').classList.add('in-combat');
      document.getElementById('mainButtons').style.display = 'none';
      document.getElementById('combatButtons').style.display = 'flex';

      log(`‚öîÔ∏è &gt;&gt; HOSTILE DETECTED: ${enemyData.name.toUpperCase()} [LVL ${gameState.player.floor}]${isBoss ? ' [BOSS]' : ''}`, isBoss ? 'boss' : 'combat');
      updateUI();
    }

    function attackEnemy() {
      if (!gameState.enemy) return;

      combatGraphics.showActionIndicator('player', '‚öîÔ∏è');
      combatGraphics.applyCombatClass('player', 'attacking');
      combatGraphics.showSlashEffect('player', 'enemy');

      const baseDmg = gameState.player.strength + (gameState.inventory.weapon ? gameState.inventory.weapon.str : 0);
      const isCrit = Math.random() < (gameState.player.agility / 100);
      const damage = Math.max(1, Math.floor((baseDmg * (isCrit ? 2 : 1)) - gameState.enemy.defense * 0.5));

      gameState.enemy.hp -= damage;
      combatGraphics.showDamageNumber(damage, 'enemy', isCrit);
      combatGraphics.applyCombatClass('enemy', 'hit');

      log(`üí• &gt;&gt; ATTACK EXECUTED: ${damage} DMG${isCrit ? ' [CRITICAL]' : ''}`, 'combat');

      if (gameState.enemy.hp <= 0) {
        enemyDefeated();
        return;
      }

      setTimeout(() => enemyTurn(), 800);
      updateUI();
    }

    function defendAction() {
      gameState.player.defending = true;
      combatGraphics.showActionIndicator('player', 'üõ°Ô∏è');
      combatGraphics.showShieldEffect('player');
      combatGraphics.applyCombatClass('player', 'defending', 1000);
      log(`üõ°Ô∏è &gt;&gt; SHIELDS ACTIVATED`, 'info');
      setTimeout(() => {
        enemyTurn();
        gameState.player.defending = false;
      }, 800);
      updateUI();
    }

    function useSkill() {
      if (!gameState.player.class || gameState.player.skillCooldown > 0) return;

      const skill = data.classes[gameState.player.class].skill;
      if (gameState.player.mana < skill.cost) {
        log(`‚ö†Ô∏è &gt;&gt; INSUFFICIENT ENERGY`, 'info');
        return;
      }

      gameState.player.mana -= skill.cost;
      gameState.player.skillCooldown = skill.cd;

      combatGraphics.showActionIndicator('player', '‚ú®');
      combatGraphics.showFireParticles('enemy');

      const baseDmg = gameState.player.intelligence * 3;
      const damage = Math.max(1, Math.floor(baseDmg - gameState.enemy.defense * 0.3));
      gameState.enemy.hp -= damage;

      combatGraphics.showDamageNumber(damage, 'enemy', true);
      combatGraphics.applyCombatClass('enemy', 'hit');

      log(`‚ú® &gt;&gt; ${skill.name.toUpperCase()} ACTIVATED: ${damage} DMG`, 'success');

      if (gameState.enemy.hp <= 0) {
        enemyDefeated();
        return;
      }

      setTimeout(() => enemyTurn(), 800);
      updateUI();
    }

    function usePotion() {
      const potions = gameState.inventory.items.filter(i => i.heal || i.mana);
      if (!potions.length) {
        log(`‚ö†Ô∏è &gt;&gt; NO STIMS AVAILABLE`, 'info');
        return;
      }

      const potion = potions[0];
      const index = gameState.inventory.items.indexOf(potion);
      gameState.inventory.items.splice(index, 1);

      if (potion.heal) {
        const healed = Math.min(potion.heal, gameState.player.maxHP - gameState.player.hp);
        gameState.player.hp += healed;
        combatGraphics.showDamageNumber(healed, 'player', false, true);
        log(`üß™ &gt;&gt; HEALTH STIM USED: +${healed} HP`, 'success');
      } else if (potion.mana) {
        const restored = Math.min(potion.mana, gameState.player.maxMana - gameState.player.mana);
        gameState.player.mana += restored;
        log(`‚ú® &gt;&gt; ENERGY CELL USED: +${restored} ENERGY`, 'success');
      }

      setTimeout(() => enemyTurn(), 500);
      updateUI();
    }

    function attemptFlee() {
      const fleeChance = 0.5 + (gameState.player.agility / 200);
      if (Math.random() < fleeChance) {
        log(`üèÉ &gt;&gt; EXTRACTION SUCCESSFUL`, 'success');
        endCombat();
      } else {
        log(`‚ö†Ô∏è &gt;&gt; EXTRACTION FAILED`, 'combat');
        setTimeout(() => enemyTurn(), 500);
      }
    }

    function enemyTurn() {
      if (!gameState.enemy || !gameState.inCombat) return;

      if (gameState.player.skillCooldown > 0) {
        gameState.player.skillCooldown--;
      }

      combatGraphics.showActionIndicator('enemy', '‚öîÔ∏è');
      combatGraphics.applyCombatClass('enemy', 'attacking');
      combatGraphics.showSlashEffect('enemy', 'player');

      const enemyDmg = gameState.enemy.attack;
      const totalDef = gameState.player.defense + (gameState.inventory.armor ? gameState.inventory.armor.def : 0);
      const reduction = gameState.player.defending ? 0.5 : 1;
      const damage = Math.max(1, Math.floor((enemyDmg - totalDef * 0.5) * reduction));

      gameState.player.hp -= damage;
      combatGraphics.showDamageNumber(damage, 'player');
      combatGraphics.applyCombatClass('player', 'hit');

      log(`üí¢ &gt;&gt; HOSTILE ATTACK: ${damage} DMG${gameState.player.defending ? ' [REDUCED]' : ''}`, 'combat');

      if (gameState.player.hp <= 0) {
        gameOver();
      }

      updateUI();
    }

    function enemyDefeated() {
      const xpGain = Math.floor(20 + gameState.player.floor * 5);
      const goldGain = Math.floor(10 + gameState.player.floor * 3);
      const matsGain = Math.floor(Math.random() * 3) + 1;

      gameState.player.exp += xpGain;
      gameState.player.gold += goldGain;
      gameState.inventory.materials += matsGain;
      gameState.monstersKilled++;

      log(`‚úÖ &gt;&gt; HOSTILE ELIMINATED: +${xpGain} XP, +${goldGain} CR, +${matsGain} PARTS`, 'success');

      checkAchievement('first_kill', 1);
      checkAchievement('kills_50', gameState.meta.totalKills + gameState.monstersKilled);
      if (gameState.enemy.isBoss) checkAchievement('boss_kill', 1);

      if (Math.random() < 0.3) {
        dropLoot();
      }

      if (gameState.player.exp >= gameState.player.expToLevel) {
        levelUp();
      }

      if (gameState.enemy.isBoss || gameState.roomsExplored >= 5) {
        document.getElementById('nextFloorBtn').style.display = 'block';
      }

      endCombat();
      updateUI();
    }

    function endCombat() {
      gameState.enemy = null;
      gameState.inCombat = false;
      document.getElementById('combatZone').classList.remove('in-combat');
      document.getElementById('enemyVisual').style.backgroundImage = '';
      document.getElementById('mainButtons').style.display = 'flex';
      document.getElementById('combatButtons').style.display = 'none';
      updateUI();
    }

    function dropLoot() {
      const roll = Math.random();
      let item;

      if (roll < 0.4) {
        item = data.potions[Math.floor(Math.random() * data.potions.length)];
      } else if (roll < 0.7) {
        const tier = Math.min(Math.floor(gameState.player.floor / 3), data.weapons.length - 1);
        item = data.weapons[tier];
      } else {
        const tier = Math.min(Math.floor(gameState.player.floor / 3), data.armor.length - 1);
        item = data.armor[tier];
      }

      gameState.inventory.items.push(item);
      log(`üì¶ &gt;&gt; LOOT ACQUIRED: ${item.name.toUpperCase()} [${item.rarity.toUpperCase()}]`, 'success');
    }

    function levelUp() {
      gameState.player.level++;
      gameState.player.exp = 0;
      gameState.player.expToLevel = Math.floor(gameState.player.expToLevel * 1.5);

      gameState.player.strength += 2;
      gameState.player.agility += 2;
      gameState.player.intelligence += 2;
      gameState.player.defense += 1;
      gameState.player.maxHP += 10;
      gameState.player.hp = gameState.player.maxHP;
      gameState.player.maxMana += 5;
      gameState.player.mana = gameState.player.maxMana;

      log(`‚¨ÜÔ∏è &gt;&gt; LEVEL UP! NOW LEVEL ${gameState.player.level}`, 'achievement');
      checkAchievement('level_10', gameState.player.level);
    }

    function nextFloor() {
      gameState.player.floor++;
      gameState.roomsExplored = 0;
      document.getElementById('nextFloorBtn').style.display = 'none';

      if (gameState.player.floor > gameState.meta.bestFloor) {
        gameState.meta.bestFloor = gameState.player.floor;
        saveMeta();
      }

      log(`üîª &gt;&gt; DESCENDING TO SECTOR ${gameState.player.floor}`, 'room');
      checkAchievement('floor_5', gameState.player.floor);
      checkAchievement('floor_10', gameState.player.floor);
      updateUI();
    }

    function equipItem(item, index) {
      if (item.str) {
        if (gameState.inventory.weapon) {
          gameState.inventory.items.push(gameState.inventory.weapon);
        }
        gameState.inventory.weapon = item;
        gameState.inventory.items.splice(index, 1);
        log(`‚öîÔ∏è &gt;&gt; WEAPON EQUIPPED: ${item.name.toUpperCase()}`, 'success');
      } else if (item.def) {
        if (gameState.inventory.armor) {
          gameState.inventory.items.push(gameState.inventory.armor);
        }
        gameState.inventory.armor = item;
        gameState.inventory.items.splice(index, 1);
        log(`üõ°Ô∏è &gt;&gt; ARMOR EQUIPPED: ${item.name.toUpperCase()}`, 'success');
      }

      if (item.rarity === 'Legendary') {
        checkAchievement('legendary', 1);
      }

      updateUI();
    }

    function openShop() {
      document.getElementById('shopGold').textContent = gameState.player.gold;
      const shopGrid = document.getElementById('shopGrid');
      shopGrid.innerHTML = [...data.weapons, ...data.armor, ...data.potions].map(item => {
        const stat = item.str ? `+${item.str} PWR` : item.def ? `+${item.def} ARM` : item.heal ? `+${item.heal} HP` : `+${item.mana} ENERGY`;
        const itemImg = getItemImage(item);
        return `<div class="item-card rarity-${item.rarity.toLowerCase()}" onclick="buyItem('${item.name}')" data-tooltip="${item.name}: ${stat} - ${item.cost} CR">
          <div class="item-image">${itemImg}</div>
          <div class="item-name">${item.name}</div>
          <div style="font-size: 0.8em; margin-top: 4px; color: var(--neon-yellow);">${item.cost} CR</div>
        </div>`;
      }).join('');
      document.getElementById('shopModal').style.display = 'flex';
    }

    function closeShop() {
      document.getElementById('shopModal').style.display = 'none';
    }

    function buyItem(itemName) {
      const item = [...data.weapons, ...data.armor, ...data.potions].find(i => i.name === itemName);
      if (!item || gameState.player.gold < item.cost) {
        log(`‚ö†Ô∏è &gt;&gt; INSUFFICIENT CREDITS`, 'info');
        return;
      }

      gameState.player.gold -= item.cost;
      gameState.inventory.items.push(item);
      log(`üí∞ &gt;&gt; PURCHASED: ${item.name.toUpperCase()} (-${item.cost} CR)`, 'success');
      updateUI();
      openShop();
    }

    function openCrafting() {
      document.getElementById('craftMats').textContent = gameState.inventory.materials;
      document.getElementById('craftModal').style.display = 'flex';
    }

    function closeCrafting() {
      document.getElementById('craftModal').style.display = 'none';
    }

    function craftItem(type) {
      if (type === 'upgrade_weapon' && gameState.inventory.materials >= 10 && gameState.inventory.weapon) {
        gameState.inventory.materials -= 10;
        gameState.inventory.weapon.str += 5;
        log(`‚öîÔ∏è &gt;&gt; WEAPON UPGRADED: ${gameState.inventory.weapon.name.toUpperCase()} (+5 PWR)`, 'success');
      } else if (type === 'upgrade_armor' && gameState.inventory.materials >= 10 && gameState.inventory.armor) {
        gameState.inventory.materials -= 10;
        gameState.inventory.armor.def += 5;
        log(`üõ°Ô∏è &gt;&gt; ARMOR UPGRADED: ${gameState.inventory.armor.name.toUpperCase()} (+5 ARM)`, 'success');
      } else if (type === 'craft_potion' && gameState.inventory.materials >= 5) {
        gameState.inventory.materials -= 5;
        gameState.inventory.items.push(data.potions[0]);
        log(`üß™ &gt;&gt; HEALTH STIM CRAFTED`, 'success');
      } else if (type === 'craft_mana' && gameState.inventory.materials >= 5) {
        gameState.inventory.materials -= 5;
        gameState.inventory.items.push(data.potions[2]);
        log(`‚ú® &gt;&gt; ENERGY CELL CRAFTED`, 'success');
      } else {
        log(`‚ö†Ô∏è &gt;&gt; INSUFFICIENT PARTS OR NO EQUIPMENT`, 'info');
      }
      updateUI();
      openCrafting();
    }

    function openAchievements() {
      const achList = document.getElementById('achievementList');
      achList.innerHTML = data.achievements.map(ach => {
        const unlocked = gameState.meta.achievements.includes(ach.id);
        return `<div class="item-card ${unlocked ? 'rarity-legendary' : 'rarity-common'}" data-tooltip="${ach.desc}">
          <div style="font-size: 2.5em; margin-bottom: 8px;">${ach.icon}</div>
          <div class="item-name">${ach.name}</div>
          <div style="font-size: 0.75em; margin-top: 4px; color: ${unlocked ? 'var(--neon-green)' : 'var(--text-muted)'};">${unlocked ? 'COMPLETED' : 'LOCKED'}</div>
        </div>`;
      }).join('');
      document.getElementById('achievementsModal').style.display = 'flex';
    }

    function closeAchievements() {
      document.getElementById('achievementsModal').style.display = 'none';
    }

    function checkAchievement(id, value) {
      if (gameState.meta.achievements.includes(id)) return;

      let unlock = false;
      if (id === 'first_kill' && value >= 1) unlock = true;
      if (id === 'floor_5' && value >= 5) unlock = true;
      if (id === 'floor_10' && value >= 10) unlock = true;
      if (id === 'level_10' && value >= 10) unlock = true;
      if (id === 'kills_50' && value >= 50) unlock = true;
      if (id === 'boss_kill' && value >= 1) unlock = true;
      if (id === 'legendary' && value >= 1) unlock = true;
      if (id === 'rich' && value >= 1000) unlock = true;

      if (unlock) {
        gameState.meta.achievements.push(id);
        const ach = data.achievements.find(a => a.id === id);
        log(`üèÜ &gt;&gt; MISSION COMPLETE: ${ach.name.toUpperCase()}`, 'achievement');
        saveMeta();
      }
    }

    function gameOver() {
      gameState.meta.totalRuns++;
      gameState.meta.totalKills += gameState.monstersKilled;
      saveMeta();

      const deathImg = getPollinationImage(`cyberpunk death scene, fallen operative, glitching screen, neon game over, digital corruption`, Date.now(), 'enemy');
      document.getElementById('deathScene').style.backgroundImage = `url(${deathImg})`;
      document.getElementById('deathScene').style.backgroundSize = 'cover';
      document.getElementById('deathScene').style.backgroundPosition = 'center';

      document.getElementById('finalFloor').textContent = gameState.player.floor;
      document.getElementById('finalLevel').textContent = gameState.player.level;
      document.getElementById('finalKills').textContent = gameState.monstersKilled;
      document.getElementById('finalGold').textContent = gameState.player.gold;
      document.getElementById('gameOverModal').style.display = 'flex';

      log('üíÄ &gt;&gt; &lt;strong&gt;SYSTEM FAILURE - OPERATIVE DOWN&lt;/strong&gt;', 'combat');
    }

    function restartGame() {
      document.getElementById('gameOverModal').style.display = 'none';
      generateCharacter();
    }

    function log(message, type = 'info') {
      const logDiv = document.getElementById('gameLog');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.innerHTML = message;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function updateUI() {
      document.getElementById('charClass').textContent = gameState.player.class || '-';
      document.getElementById('charLevel').textContent = gameState.player.level;
      document.getElementById('charRarity').textContent = gameState.player.rarity;
      document.getElementById('charFloor').textContent = gameState.player.floor;
      document.getElementById('statStr').textContent = gameState.player.strength;
      document.getElementById('statAgi').textContent = gameState.player.agility;
      document.getElementById('statInt').textContent = gameState.player.intelligence;
      document.getElementById('statDef').textContent = gameState.player.defense;

      const hpPct = Math.max(0, (gameState.player.hp / gameState.player.maxHP) * 100);
      document.getElementById('hpBar').style.width = hpPct + '%';
      document.getElementById('hpText').textContent = `${Math.max(0, gameState.player.hp)}/${gameState.player.maxHP}`;

      const manaPct = (gameState.player.mana / gameState.player.maxMana) * 100;
      document.getElementById('manaBar').style.width = manaPct + '%';
      document.getElementById('manaText').textContent = `${gameState.player.mana}/${gameState.player.maxMana}`;

      const xpPct = (gameState.player.exp / gameState.player.expToLevel) * 100;
      document.getElementById('xpBar').style.width = xpPct + '%';
      document.getElementById('xpText').textContent = `${gameState.player.exp}/${gameState.player.expToLevel}`;

      document.getElementById('playerEffects').innerHTML = gameState.player.effects.map(e =>
        `<div class="effect-badge effect-${e.type}" data-tooltip="${e.type.toUpperCase()}: ${e.duration} turns">${e.type.toUpperCase()} ${e.duration}</div>`
      ).join('');

      if (gameState.player.class) {
        const skill = data.classes[gameState.player.class].skill;
        document.getElementById('skillPanel').style.display = 'block';
        document.getElementById('skillName').textContent = skill.name;
        document.getElementById('skillDesc').textContent = skill.effect;
        document.getElementById('skillCost').textContent = skill.cost;
        document.getElementById('skillCD').textContent = gameState.player.skillCooldown > 0 ? gameState.player.skillCooldown : 'Ready';

        const skillBtn = document.getElementById('skillBtn');
        if (skillBtn) skillBtn.disabled = gameState.player.skillCooldown > 0 || gameState.player.mana < skill.cost;
      }

      if (gameState.enemy) {
        document.getElementById('enemyName').textContent = gameState.enemy.name;
        document.getElementById('enemyLevel').textContent = gameState.enemy.level;
        document.getElementById('enemyAtk').textContent = gameState.enemy.attack;
        document.getElementById('enemyDef').textContent = gameState.enemy.defense;

        const enemyHpPct = Math.max(0, (gameState.enemy.hp / gameState.enemy.maxHP) * 100);
        document.getElementById('enemyHpBar').style.width = enemyHpPct + '%';
        document.getElementById('enemyHpText').textContent = `${Math.max(0, gameState.enemy.hp)}/${gameState.enemy.maxHP}`;
        document.getElementById('combatStatus').textContent = 'üî¥ ENGAGED';

        document.getElementById('enemyEffects').innerHTML = gameState.enemy.effects.map(e =>
          `<div class="effect-badge effect-${e.type}" data-tooltip="${e.type.toUpperCase()}: ${e.duration} turns">${e.type.toUpperCase()} ${e.duration}</div>`
        ).join('');
      } else {
        document.getElementById('enemyName').textContent = 'NO TARGET';
        document.getElementById('enemyLevel').textContent = '-';
        document.getElementById('enemyAtk').textContent = '0';
        document.getElementById('enemyDef').textContent = '0';
        document.getElementById('enemyHpBar').style.width = '0%';
        document.getElementById('enemyHpText').textContent = '0/0';
        document.getElementById('combatStatus').textContent = 'üü¢ STANDBY';
        document.getElementById('enemyEffects').innerHTML = '';
      }

      const potions = gameState.inventory.items.filter(i => i.heal || i.mana);
      const potionBtn = document.getElementById('potionBtn');
      if (potionBtn) {
        potionBtn.textContent = `[P] STIM (${potions.length})`;
        potionBtn.disabled = !potions.length;
      }

      document.getElementById('equippedWeapon').innerHTML = gameState.inventory.weapon ?
        `<span class="rarity-${gameState.inventory.weapon.rarity.toLowerCase()}">${gameState.inventory.weapon.name} (+${gameState.inventory.weapon.str})</span>` : 'None';
      document.getElementById('equippedArmor').innerHTML = gameState.inventory.armor ?
        `<span class="rarity-${gameState.inventory.armor.rarity.toLowerCase()}">${gameState.inventory.armor.name} (+${gameState.inventory.armor.def})</span>` : 'None';

      document.getElementById('itemCount').textContent = gameState.inventory.items.length;
      document.getElementById('matsCount').textContent = gameState.inventory.materials;

      const invGrid = document.getElementById('inventoryGrid');
      if (!gameState.inventory.items.length) {
        invGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: var(--text-muted); padding: 20px;">EMPTY</div>';
      } else {
        invGrid.innerHTML = gameState.inventory.items.map((item, i) => {
          const stat = item.str ? `+${item.str} PWR` : item.def ? `+${item.def} ARM` : item.heal ? `+${item.heal} HP` : `+${item.mana} ENERGY`;
          const itemImg = getItemImage(item);
          return `<div class="item-card rarity-${item.rarity.toLowerCase()}" onclick="equipItem(gameState.inventory.items[${i}], ${i})" data-tooltip="${item.name}: ${stat}">
            <div class="item-image">${itemImg}</div>
            <div class="item-name">${item.name}</div>
          </div>`;
        }).join('');
      }

      document.getElementById('headerGold').textContent = gameState.player.gold;
      document.getElementById('headerBest').textContent = gameState.meta.bestFloor;
      document.getElementById('headerKills').textContent = gameState.meta.totalKills;
      document.getElementById('headerRuns').textContent = gameState.meta.totalRuns;

      checkAchievement('rich', gameState.player.gold);
    }

    function saveMeta() {
      localStorage.setItem('cyber_dungeon_meta', JSON.stringify(gameState.meta));
    }

    const saved = localStorage.getItem('cyber_dungeon_meta');
    if (saved) Object.assign(gameState.meta, JSON.parse(saved));

    updateUI();
  </script>
</body>
</html>